events {
  worker_connections  4096;  ## Default: 1024
}

http {
  include /etc/nginx/mime.types;

  upstream backend {
    server localhost:3000;
  }

  upstream apache {
    server localhost:8080;
  }

  server {
      root /usr/share/nginx/html;

      location /featured {
        proxy_pass http://backend/featured ;
      }
      location /popular {
        proxy_pass http://backend/popular ;
      }
      location ~ ^/api {
        proxy_pass http://backend;
      }

      location ~ ^/php {
        proxy_pass http://apache;
      }

      location / {
        error_page 404 =200 /index.html;
      }

  }
}
